

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shared Cache &mdash; Olive  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/width.css?v=b55249da" />
      <link rel="stylesheet" type="text/css" href="../_static/css/header.css?v=5dcc4e7b" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script src="../_static/js/custom_version.js?v=3856a39b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Workflow" href="run_workflow_remotely.html" />
    <link rel="prev" title="Packaging Olive artifacts" href="packaging_output_models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Olive
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">OVERVIEW</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/olive.html">Olive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/quicktour.html">Quick Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/options.html">Olive Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GET STARTED</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getstarted/quickstart_examples.html">Quickstart Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXAMPLES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">OLIVE COMMANDS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Run</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#finetune">Finetune</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#auto-optimization">Auto-Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#quantization">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#capture-onnx-graph">Capture Onnx Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#generate-adapters">Generate Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#convert-adapters">Convert Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#tune-onnxruntime-session-params">Tune OnnxRuntime Session Params</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#generate-cost-model-for-model-splitting">Generate Cost Model for Model Splitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#qualcomm-sdk">Qualcomm SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#azureml">AzureML</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#shared-cache">Shared Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#providing-input-models">Providing Input Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html#model-script-file-information">Model Script File Information</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FEATURES</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="azureml_integration.html">Azure ML integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="huggingface_model_optimization.html">Huggingface Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="lora.html">LoRA Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging_output_models.html">Packaging Olive artifacts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Shared Cache</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-and-usage">Setup and Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-dependencies">Install Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-azure-blob-storage">Configure Azure Blob Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-shared-cache">Configure the Shared Cache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#alternative-configuration">Alternative Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#important-notes">Important Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run_workflow_remotely.html">Remote Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="conversion.html">Model Conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="quantization.html">Model Quantizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_transformations_and_optimizations.html">Model Transformations and Optimizations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXTENDING OLIVE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../extending_olive/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending_olive/how_to_add_optimization_pass.html">How to add new optimization Pass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../extending_olive/custom_scripts.html">Custom Scripts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_systems.html">How To Configure System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_metrics.html">How To Configure Metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_auto_optimizer.html">How To Configure Auto Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_pass.html">How To Configure Pass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_data.html">How To Configure Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_model_path.html">How To Set Model Path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/advanced_users.html">Advanced User Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/azure_arc.html">Self-hosted Kubernetes cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/azureml_scripts.html">Azure ML scripts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">OliveModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/resource_path.html">ResourcePath</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/systems.html">OliveSystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/evaluator.html">OliveEvaluator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/metric.html">Metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/search-algorithms.html">SearchAlgorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/engine.html">Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/passes.html">Passes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Olive</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Shared Cache</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/features/shared_cache.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="shared-cache">
<h1>Shared Cache<a class="headerlink" href="#shared-cache" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>The Shared Cache allows Olive to store intermediate models in Azure Blob Storage. When a pass is executed, Olive checks if the same pass with the same input model has been processed before. If a matching output model is found in the shared cache, Olive reuses it for the next step. With this feature, you can easily share output models with others.</p>
</section>
<section id="setup-and-usage">
<h2>Setup and Usage<a class="headerlink" href="#setup-and-usage" title="Permalink to this heading"></a></h2>
<section id="install-dependencies">
<h3>Install Dependencies<a class="headerlink" href="#install-dependencies" title="Permalink to this heading"></a></h3>
<p>Install the required dependencies for enabling shared cache support:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>olive-ai<span class="o">[</span>shared-cache<span class="o">]</span>
</pre></div>
</div>
</section>
<section id="configure-azure-blob-storage">
<h3>Configure Azure Blob Storage<a class="headerlink" href="#configure-azure-blob-storage" title="Permalink to this heading"></a></h3>
<p>Olive uses Azure Blob Storage for the shared cache. You need to set up an Azure Blob Storage container for this feature. Learn more about <a class="reference external" href="https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction">Azure Blob Storage</a>.</p>
<p>Once your container is ready, locate the account name and container name on your storage account page. The account URL typically looks like <code class="docutils literal notranslate"><span class="pre">https://&lt;account_name&gt;.blob.core.windows.net</span></code>.</p>
<p>Make sure you are logged in to Azure by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>az<span class="w"> </span>login
</pre></div>
</div>
</section>
<section id="configure-the-shared-cache">
<h3>Configure the Shared Cache<a class="headerlink" href="#configure-the-shared-cache" title="Permalink to this heading"></a></h3>
<p>To enable the shared cache, add the Azure Blob Storage account URL with container name to the cache_dir field in your configuration file:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="w">    </span><span class="nt">&quot;cache_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://&lt;account_name&gt;.blob.core.windows.net/&lt;container_name&gt;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to custom local cache directory also, you can provide multiple <code class="docutils literal notranslate"><span class="pre">cache_dir</span></code>:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="w">    </span><span class="nt">&quot;cache_dir&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;local_cache&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;https://myaccountname.blob.core.windows.net/mycontainername&quot;</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When you set up the shared cache this way, <code class="docutils literal notranslate"><span class="pre">update_shared_cache</span></code> will default to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
</section>
<section id="alternative-configuration">
<h3>Alternative Configuration<a class="headerlink" href="#alternative-configuration" title="Permalink to this heading"></a></h3>
<p>You can also configure the shared cache using the <code class="docutils literal notranslate"><span class="pre">cache_config</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cache_config</span></code>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">account_name</span> <span class="pre">[str]</span></code>: The account name from the Azure Storage account.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">container_name</span> <span class="pre">[str]</span></code>: The container name to store model cache.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update_shared_cache</span> <span class="pre">[bool]</span></code>: If True, Olive will upload output models to the shared cache. Defaults to True.</p></li>
</ul>
</li>
</ul>
<p>Here is an example configuration:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="w">    </span><span class="nt">&quot;cache_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;account_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;account-name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;container_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;container-name&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;update_shared_cache&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With this configuration, Olive will check if a cached model exists in your blob container. If you only want to download cached models from the blob without uploading the output models, set <code class="docutils literal notranslate"><span class="pre">update_shared_cache</span></code> to <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
</section>
</section>
<section id="important-notes">
<h2>Important Notes<a class="headerlink" href="#important-notes" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>The Shared Cache feature does not support models with Callable attributes, such as <code class="docutils literal notranslate"><span class="pre">model_loader</span></code>, <code class="docutils literal notranslate"><span class="pre">io_config</span></code>, or <code class="docutils literal notranslate"><span class="pre">dummy_inputs_func</span></code>, if any of these is a Callable, shared cache will be disabled.</p></li>
<li><p>If the output model is found in the shared cache and evaluation is needed, Olive will download the output model from the shared cache.</p></li>
<li><p>If no evaluation is required, Olive skips downloading intermediate models if cached models are found for the next pass.</p></li>
<li><p>If the output model is found in the shared cache and no evaluation is needed, Olive will check for cached models for the next Pass instead of immediately downloading the current cached model. If a cached model for the next Pass is found, Olive will skip downloading the intermediate model and proceed directly to the next Pass. This process will continue until the final Pass is completed or no cached model is found.</p></li>
<li><p>When this feature is enabled, the workflow running time may be affected, potentially making it faster or slower. Since Olive will download output models, factors that can influence this include the size of the output model, internet speed, the number of Passes, and how many intermediate models are cached in the shared cache.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="packaging_output_models.html" class="btn btn-neutral float-left" title="Packaging Olive artifacts" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="run_workflow_remotely.html" class="btn btn-neutral float-right" title="Remote Workflow" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, olivedevteam@microsoft.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>