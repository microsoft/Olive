
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>ONNX Transformations &#8212; Olive 0.9.2 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/header.css?v=5dcc4e7b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=aa3b121e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'features/onnx-transformations';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://microsoft.github.io/Olive/_static/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '0.9.2';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            true;
        </script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PEFT Adapters" href="peft-adapters.html" />
    <link rel="prev" title="Model Splitting" href="model-splitting.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.9.2" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Olive 0.9.2 documentation</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../why-olive.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting-started/getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to/index.html">
    How Tos
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="index.html">
    Features
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../why-olive.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting-started/getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to/index.html">
    How Tos
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Features</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">ONNX Transformations</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="onnx-transformations">
<h1>ONNX Transformations<a class="headerlink" href="#onnx-transformations" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://onnx.ai/">ONNX</a> is an open graph format to represent machine learning models. <a class="reference external" href="https://onnxruntime.ai/docs/">ONNX Runtime</a> is a cross-platform machine-learning model accelerator, with a flexible interface to integrate hardware-specific libraries.</p>
<p>Olive provides multiple transformations and optimizations based on various ONNX to improve model performance.</p>
<section id="peeophole-optimizer">
<h2>Peeophole Optimizer<a class="headerlink" href="#peeophole-optimizer" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">OnnxPeepholeOptimizer</span></code> optimizes an ONNX model. The optimization process involves analyzing the structure of the ONNX model and identifying opportunities.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">OnnxPeepholeOptimizer</span></code> leverages <code class="docutils literal notranslate"><span class="pre">onnxscript</span></code> (https://onnxscript.ai/tutorial/optimizer/optimize.html) and <code class="docutils literal notranslate"><span class="pre">onnxoptimizer</span></code>(https://github.com/onnx/optimizer) underneath.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Optimization</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Constant Folding</strong></p></td>
<td><p>Applies constant folding optimization to the model.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Constant Propagation</strong></p></td>
<td><p>Applies constant propagation optimization to the model. Applied as part of constant folding.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Sequence Simplification</strong></p></td>
<td><p>Simplifies Sequence-based ops (e.g., SequenceConstruct, ConcatFromSequence). Part of constant folding.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Remove Unused Nodes</strong></p></td>
<td><p>Removes unused nodes from the model.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Remove Unused Functions</strong></p></td>
<td><p>Removes unused function protos from the model.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Inline Functions with Unused Outputs</strong></p></td>
<td><p>Inlines function nodes with unused outputs.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Inline Simple Functions</strong></p></td>
<td><p>Inlines simple functions based on a node count threshold.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop Cast</strong></p></td>
<td><p>Eliminates no-operation (nop) Casts.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Nop Dropout</strong></p></td>
<td><p>Eliminates no-operation Dropouts.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop Flatten</strong></p></td>
<td><p>Eliminates no-operation Flattens.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Extract Constant to Initializer</strong></p></td>
<td><p>Extracts constants to initializers.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate If with Const Cond</strong></p></td>
<td><p>Eliminates If nodes with constant conditions.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Nop Monotone ArgMax</strong></p></td>
<td><p>Eliminates nop monotone ArgMax.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop Pad</strong></p></td>
<td><p>Eliminates no-operation Pads.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Nop Concat</strong></p></td>
<td><p>Eliminates no-operation Concats.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop Split</strong></p></td>
<td><p>Eliminates no-operation Splits.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Nop Expand</strong></p></td>
<td><p>Eliminates no-operation Expands.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Shape Gather</strong></p></td>
<td><p>Eliminates Shape Gather operations.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Slice after Shape</strong></p></td>
<td><p>Eliminates Slice nodes that occur after Shape nodes.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop Transpose</strong></p></td>
<td><p>Eliminates no-operation Transposes.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Add Bias into Conv</strong></p></td>
<td><p>Fuses Add operations as biases into Conv layers.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse BN into Conv</strong></p></td>
<td><p>Fuses BatchNormalization into Conv layers.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Consecutive Concats</strong></p></td>
<td><p>Fuses consecutive Concat operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse Consecutive LogSoftmax</strong></p></td>
<td><p>Fuses consecutive LogSoftmax operations.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Consecutive Reduce+Unsqueeze</strong></p></td>
<td><p>Fuses consecutive Reduce and Unsqueeze operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse Consecutive Squeezes</strong></p></td>
<td><p>Fuses consecutive Squeeze operations.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Consecutive Transposes</strong></p></td>
<td><p>Fuses consecutive Transpose operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse MatMul+Add Bias into GEMM</strong></p></td>
<td><p>Fuses MatMul and Add operations into GEMM layers.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Pad into Conv</strong></p></td>
<td><p>Fuses Pad operations into Conv layers.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse Pad into Pool</strong></p></td>
<td><p>Fuses Pad operations into Pool layers.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Transpose into GEMM</strong></p></td>
<td><p>Fuses Transpose operations into GEMM layers.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse Concat into Reshape</strong></p></td>
<td><p>Fuses Concat operations into Reshape layers.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Nop Reshape</strong></p></td>
<td><p>Eliminates no-operation Reshapes.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Nop with Unit</strong></p></td>
<td><p>Eliminates no-operation nodes with unit values.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Common Subexpression</strong></p></td>
<td><p>Eliminates common sub-expressions.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Fuse QKV</strong></p></td>
<td><p>Fuses query, key, and value layers in transformer models.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Consecutive Unsqueezes</strong></p></td>
<td><p>Fuses consecutive Unsqueeze operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Deadend Nodes</strong></p></td>
<td><p>Eliminates dead-end nodes.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Identity Nodes</strong></p></td>
<td><p>Eliminates Identity nodes.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Shape Ops</strong></p></td>
<td><p>Eliminates Shape operations where possible.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Fuse Consecutive Slices</strong></p></td>
<td><p>Fuses consecutive Slice operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Eliminate Unused Initializer</strong></p></td>
<td><p>Eliminates unused initializers.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Eliminate Duplicate Initializer</strong></p></td>
<td><p>Eliminates duplicate initializers.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Broadcast to MatMul</strong></p></td>
<td><p>Converts broadcast patterns into MatMul operations for better efficiency.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Cast Constant of Shape</strong></p></td>
<td><p>Simplifies constant casting for shape operations.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEMM to MatMul+Add</strong></p></td>
<td><p>Converts GEMM operations into MatMul and Add for improved compatibility.</p></td>
</tr>
<tr class="row-even"><td><p><strong>No-Op Removal</strong></p></td>
<td><p>Removes redundant or no-op operations in the computation graph.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Please refer to <a class="reference internal" href="../reference/pass.html#onnx_peephole_optimizer"><span class="std std-ref">OnnxPeepholeOptimizer</span></a> for more details about the pass and its config parameters.</p>
<section id="example-configuration">
<h3>Example Configuration<a class="headerlink" href="#example-configuration" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OnnxPeepholeOptimizer&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="ort-transformers-optimization">
<h2>ORT Transformers Optimization<a class="headerlink" href="#ort-transformers-optimization" title="Link to this heading">#</a></h2>
<p>While ONNX Runtime automatically applies most optimizations while loading transformer models, some of the latest optimizations that have not
yet been integrated into ONNX Runtime.
<code class="docutils literal notranslate"><span class="pre">OrtTransformersOptimization</span></code> provides an offline capability to optimize <a class="reference external" href="https://huggingface.co/docs/transformers/index">transformers</a> models
in scenarios where ONNX Runtime does not apply the optimization at load time.
These optimizations are provided by onnxruntime through
<a class="reference external" href="https://github.com/microsoft/onnxruntime/tree/main/onnxruntime/python/tools/transformers">onnxruntime.transformers</a>. Please
refer to the <a class="reference external" href="https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/python/tools/transformers/README.md">corresponding documentation</a>
for more details on the optimizations done by this tool.</p>
<p>Please refer to <a class="reference internal" href="../reference/pass.html#ort_transformers_optimization"><span class="std std-ref">OrtTransformersOptimization</span></a> for more details about the pass and its config parameters.</p>
<section id="id1">
<h3>Example Configuration<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OrtTransformersOptimization&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;model_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;bert&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="onnx-surgeries">
<h2>ONNX Surgeries<a class="headerlink" href="#onnx-surgeries" title="Link to this heading">#</a></h2>
<p>Olive provides ability to apply many graph <code class="docutils literal notranslate"><span class="pre">surgeries</span></code> on the ONNX model. In the examples, the <code class="docutils literal notranslate"><span class="pre">surgeries</span></code> Pass represents a list of surgeries to be applied sequentially on the ONNX model. You can combine multiple surgeries in the list to perform consecutive modifications in a single operation.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RenameInputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;old_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;input2&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;new_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;renamed_input1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;renamed_input2&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RenameOutputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;old_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;output2&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;new_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;renamed_output1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;renamed_output2&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;InferShapes&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="renameinputs">
<h3><code class="docutils literal notranslate"><span class="pre">RenameInputs</span></code><a class="headerlink" href="#renameinputs" title="Link to this heading">#</a></h3>
<section id="description">
<h4>Description<a class="headerlink" href="#description" title="Link to this heading">#</a></h4>
<p>Renames specific inputs in the ONNX model.</p>
</section>
<section id="configurations">
<h4>Configurations<a class="headerlink" href="#configurations" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">old_names</span></code>: List of original input names to rename.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_names</span></code>: List of new input names.</p></li>
</ul>
</section>
<section id="id2">
<h4>Example<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RenameInputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;old_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;input2&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;new_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;renamed_input1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;renamed_input2&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;renamed_input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;renamed_input2&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;renamed_input1&quot;</span><span class="p">,</span> <span class="s2">&quot;renamed_input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="renameoutputs">
<h3><code class="docutils literal notranslate"><span class="pre">RenameOutputs</span></code><a class="headerlink" href="#renameoutputs" title="Link to this heading">#</a></h3>
<section id="id3">
<h4>Description<a class="headerlink" href="#id3" title="Link to this heading">#</a></h4>
<p>Renames specific outputs in the ONNX model.</p>
</section>
<section id="id4">
<h4>Configurations<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">old_names</span></code>: List of original output names to rename.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new_names</span></code>: List of new output names.</p></li>
</ul>
</section>
<section id="id5">
<h4>Example<a class="headerlink" href="#id5" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RenameOutputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;old_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">],</span>
<span class="w">            </span><span class="nt">&quot;new_names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;renamed_output1&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;renamed_output1&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="infershapes">
<h3><code class="docutils literal notranslate"><span class="pre">InferShapes</span></code><a class="headerlink" href="#infershapes" title="Link to this heading">#</a></h3>
<section id="id6">
<h4>Description<a class="headerlink" href="#id6" title="Link to this heading">#</a></h4>
<p>Performs shape inference on the ONNX model to populate missing shape information.</p>
</section>
<section id="id7">
<h4>Example<a class="headerlink" href="#id7" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;add_output&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;InferShapes&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph (with inferred shapes):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;add_output&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removeshapes">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveShapes</span></code><a class="headerlink" href="#removeshapes" title="Link to this heading">#</a></h3>
<section id="id8">
<h4>Description<a class="headerlink" href="#id8" title="Link to this heading">#</a></h4>
<p>Removes all shape information (<code class="docutils literal notranslate"><span class="pre">value_info</span></code>) from the ONNX model.</p>
</section>
<section id="id9">
<h4>Example<a class="headerlink" href="#id9" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="n">test</span><span class="o">-</span><span class="n">model</span> <span class="p">{</span>
  <span class="c1"># Inputs</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># Value Info</span>
  <span class="n">value_info</span><span class="p">:</span> <span class="s2">&quot;intermediate&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># Nodes</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="c1"># Outputs</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;output1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveShapes&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="n">test</span><span class="o">-</span><span class="n">model</span> <span class="p">{</span>
  <span class="c1"># Inputs</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

  <span class="c1"># Nodes</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;intermediate&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="c1"># Outputs</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;output1&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">)</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removeinitializerfrominputs">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveInitializerFromInputs</span></code><a class="headerlink" href="#removeinitializerfrominputs" title="Link to this heading">#</a></h3>
<section id="id10">
<h4>Description<a class="headerlink" href="#id10" title="Link to this heading">#</a></h4>
<p>Removes initializers from the input list (<code class="docutils literal notranslate"><span class="pre">graph.input</span></code>) of an ONNX model.</p>
</section>
<section id="id11">
<h4>Example<a class="headerlink" href="#id11" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="n">initializer</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="n">FLOAT</span>
    <span class="n">dims</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">raw_data</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\000\000\200</span><span class="s2">?</span><span class="se">\000\000\000</span><span class="s2">@</span><span class="se">\000\000</span><span class="s2">@@&quot;</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveInitializerFromInputs&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">initializer</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="n">FLOAT</span>
    <span class="n">dims</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">raw_data</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\000\000\200</span><span class="s2">?</span><span class="se">\000\000\000</span><span class="s2">@</span><span class="se">\000\000</span><span class="s2">@@&quot;</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="reorderinputs">
<h3><code class="docutils literal notranslate"><span class="pre">ReorderInputs</span></code><a class="headerlink" href="#reorderinputs" title="Link to this heading">#</a></h3>
<section id="id12">
<h4>Description<a class="headerlink" href="#id12" title="Link to this heading">#</a></h4>
<p>Reorders the inputs of the ONNX model according to a specified permutation.</p>
</section>
<section id="id13">
<h4>Configurations<a class="headerlink" href="#id13" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">permutation</span></code>: A list specifying the new order of inputs, as a permutation of the original indices.</p></li>
</ul>
</section>
<section id="id14">
<h4>Example<a class="headerlink" href="#id14" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReorderInputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;permutation&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="replaceerfwithtanh">
<h3><code class="docutils literal notranslate"><span class="pre">ReplaceErfWithTanh</span></code><a class="headerlink" href="#replaceerfwithtanh" title="Link to this heading">#</a></h3>
<section id="id15">
<h4>Description<a class="headerlink" href="#id15" title="Link to this heading">#</a></h4>
<p>Replaces <code class="docutils literal notranslate"><span class="pre">Erf</span></code> nodes in the ONNX model with an equivalent computation using <code class="docutils literal notranslate"><span class="pre">Tanh</span></code>. The replacement involves scaling the input and applying the <code class="docutils literal notranslate"><span class="pre">Tanh</span></code> function to produce a result that approximates the <code class="docutils literal notranslate"><span class="pre">Erf</span></code> behavior.</p>
</section>
<section id="id16">
<h4>Example<a class="headerlink" href="#id16" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input&quot;</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;erf_output&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Erf&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;erf_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReplaceErfWithTanh&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input&quot;</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;scale_0&quot;</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="mf">1.203</span><span class="p">)</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;scale_0&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mul_0&quot;</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Sub_Mul_0&quot;</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Tanh&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mul_0&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;erf_output&quot;</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Sub_Tanh_0&quot;</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;erf_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="zerooutinput">
<h3><code class="docutils literal notranslate"><span class="pre">ZeroOutInput</span></code><a class="headerlink" href="#zerooutinput" title="Link to this heading">#</a></h3>
<section id="id17">
<h4>Description<a class="headerlink" href="#id17" title="Link to this heading">#</a></h4>
<p>Replaces a specific input of a node with a constant tensor of zeros.</p>
</section>
<section id="id18">
<h4>Configurations<a class="headerlink" href="#id18" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node_name</span></code>: Name of the node whose input is to be replaced.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">input_idx</span></code>: Index of the input to be replaced.</p></li>
</ul>
</section>
<section id="id19">
<h4>Example<a class="headerlink" href="#id19" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ZeroOutInput&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;node_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AddNode&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;input_idx&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Constant&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Add_zero_output_0&quot;</span><span class="p">]</span>
    <span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;Add_zero_output_0&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removeinputs">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveInputs</span></code><a class="headerlink" href="#removeinputs" title="Link to this heading">#</a></h3>
<section id="id20">
<h4>Description<a class="headerlink" href="#id20" title="Link to this heading">#</a></h4>
<p>Removes specific inputs from the ONNX model.</p>
</section>
<section id="id21">
<h4>Configurations<a class="headerlink" href="#id21" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code>: List of input names to remove.</p></li>
</ul>
</section>
<section id="id22">
<h4>Example<a class="headerlink" href="#id22" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveInputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;input2&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="exposeoutputs">
<h3><code class="docutils literal notranslate"><span class="pre">ExposeOutputs</span></code><a class="headerlink" href="#exposeoutputs" title="Link to this heading">#</a></h3>
<section id="id23">
<h4>Description<a class="headerlink" href="#id23" title="Link to this heading">#</a></h4>
<p>Exposes the outputs of specific nodes in the ONNX model as graph outputs.</p>
</section>
<section id="id24">
<h4>Configurations<a class="headerlink" href="#id24" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">names</span></code>: List of node names whose outputs should be exposed as graph outputs.</p></li>
</ul>
</section>
<section id="id25">
<h4>Example<a class="headerlink" href="#id25" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ExposeOutputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;names&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ReluNode&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;relu_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="exposequantizedoutput">
<h3><code class="docutils literal notranslate"><span class="pre">ExposeQuantizedOutput</span></code><a class="headerlink" href="#exposequantizedoutput" title="Link to this heading">#</a></h3>
<section id="id26">
<h4>Description<a class="headerlink" href="#id26" title="Link to this heading">#</a></h4>
<p>Replaces a specified output with its quantized version and exposes its <code class="docutils literal notranslate"><span class="pre">scale</span></code> and <code class="docutils literal notranslate"><span class="pre">zero_point</span></code> as graph outputs.</p>
</section>
<section id="id27">
<h4>Configurations<a class="headerlink" href="#id27" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">output_name</span></code>: Name of the output to replace with its quantized version.</p></li>
</ul>
</section>
<section id="id28">
<h4>Example<a class="headerlink" href="#id28" title="Link to this heading">#</a></h4>
<p>Initial ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;DequantizeLinear&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;quantized_tensor&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_point&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output1&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ExposeQuantizedOutput&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;output_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;output1&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed ONNX model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;quantized_tensor&quot;</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;scale&quot;</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;zero_point&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="decomposequickgelu">
<h3><code class="docutils literal notranslate"><span class="pre">DecomposeQuickGelu</span></code><a class="headerlink" href="#decomposequickgelu" title="Link to this heading">#</a></h3>
<section id="id29">
<h4>Description<a class="headerlink" href="#id29" title="Link to this heading">#</a></h4>
<p>Replaces QuickGelu operators with equivalent standard ONNX operators. This surgery converts a single QuickGelu node into a subgraph composed of Mul, Sigmoid, and Mul operations.</p>
<p>The QuickGelu function is mathematically defined as: <code class="docutils literal notranslate"><span class="pre">QuickGelu(x)</span> <span class="pre">=</span> <span class="pre">x</span> <span class="pre">*</span> <span class="pre">sigmoid(alpha</span> <span class="pre">*</span> <span class="pre">x)</span></code>, where alpha defaults to 1.702.</p>
<p>Reference: https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/core/graph/contrib_ops/contrib_defs.cc</p>
</section>
<section id="id30">
<h4>Example<a class="headerlink" href="#id30" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;input&quot;</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGelu&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;quickgelu_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;quickgelu_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DecomposeQuickGelu&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;input&quot;</span>
<span class="w">  </span><span class="n">initializer</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_alpha&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">:</span><span class="w"> </span><span class="mf">1.702</span><span class="p">)</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_alpha&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;QuickGeluNode_mul1_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_mul1&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Sigmoid&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;QuickGeluNode_mul1_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;QuickGeluNode_sigmoid_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_sigmoid&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_sigmoid_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;QuickGeluNode_mul2_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_mul2&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;QuickGeluNode_mul2_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pattern transformation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Original</span> <span class="n">pattern</span><span class="p">:</span>
<span class="p">[</span><span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">QuickGelu</span> <span class="o">--&gt;</span> <span class="p">[</span><span class="n">Output</span><span class="p">]</span>

<span class="n">Replaced</span> <span class="n">pattern</span><span class="p">:</span>
<span class="p">[</span><span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Mul</span> <span class="o">--&gt;</span> <span class="n">Sigmoid</span> <span class="o">--&gt;</span> <span class="n">Mul</span> <span class="o">--&gt;</span> <span class="p">[</span><span class="n">Output</span><span class="p">]</span>
             <span class="o">|</span>                    <span class="o">^</span>
             <span class="o">|</span>                    <span class="o">|</span>
             <span class="o">+--------------------+</span>
             <span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.702</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="decomposerotaryembedding">
<h3><code class="docutils literal notranslate"><span class="pre">DecomposeRotaryEmbedding</span></code><a class="headerlink" href="#decomposerotaryembedding" title="Link to this heading">#</a></h3>
<section id="id31">
<h4>Description<a class="headerlink" href="#id31" title="Link to this heading">#</a></h4>
<p>Decomposes RotaryEmbedding operator to standard ONNX operators (RoPE). This surgery converts a single RotaryEmbedding node into a subgraph composed of multiple standard ONNX operators.</p>
<p>The RotaryEmbedding function applies rotary position encoding transformations to the real and imaginary parts of input vectors.</p>
<p>Reference: https://github.com/microsoft/onnxruntime/blob/main/onnxruntime/core/graph/contrib_ops/contrib_defs.cc</p>
</section>
<section id="id32">
<h4>Example<a class="headerlink" href="#id32" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;input&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;position_ids&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;cos_cache&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;sin_cache&quot;</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbedding&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;position_ids&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;cos_cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sin_cache&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;rotaryembedding_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;rotaryembedding_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DecomposeRotaryEmbedding&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;input&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;position_ids&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;cos_cache&quot;</span>
<span class="w">  </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;sin_cache&quot;</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Reshape&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;position_ids&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_pos_flat_shape&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_pos_flat_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_pos_flat&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Gather&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;cos_cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_pos_flat_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_cos_g_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_cos_g&quot;</span>
<span class="w">    </span><span class="n">axis</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Gather&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;sin_cache&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_pos_flat_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_sin_g_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_sin_g&quot;</span>
<span class="w">    </span><span class="n">axis</span><span class="o">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Slice&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_start&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_half&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_axes&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_real&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Slice&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;input&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_half&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_end&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_slice_axes&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_imag_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_imag&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_cos_r_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_cos_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_real_cos&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_imag_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_sin_r_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_imag_sin_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_imag_sin&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Sub&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_cos_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_imag_sin_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_out_r_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_out_r&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_sin_r_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_sin_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_real_sin&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Mul&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_imag_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_cos_r_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_imag_cos_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_imag_cos&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Add&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_real_sin_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_imag_cos_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_out_i_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_out_i&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">node</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">op_type</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;Concat&quot;</span>
<span class="w">    </span><span class="n">input</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;RotaryEmbeddingNode_out_r_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_out_i_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s">&quot;rotaryembedding_output&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="n">name</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;RotaryEmbeddingNode_concat&quot;</span>
<span class="w">    </span><span class="n">axis</span><span class="o">:</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">  </span><span class="p">}</span>
<span class="w">  </span><span class="n">output</span><span class="o">:</span><span class="w"> </span><span class="s">&quot;rotaryembedding_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pattern transformation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Original</span> <span class="n">pattern</span><span class="p">:</span>
<span class="p">[</span><span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">RotaryEmbedding</span> <span class="o">--&gt;</span> <span class="p">[</span><span class="n">Output</span><span class="p">]</span>
              <span class="o">^</span>      <span class="o">^</span>
              <span class="o">|</span>      <span class="o">|</span>
    <span class="p">[</span><span class="n">position_ids</span><span class="p">]</span> <span class="p">[</span><span class="n">cos_cache</span><span class="p">,</span> <span class="n">sin_cache</span><span class="p">]</span>

<span class="n">Replaced</span> <span class="n">pattern</span><span class="p">:</span>
                                <span class="p">[</span><span class="n">position_ids</span><span class="p">]</span>
                                     <span class="o">|</span>
                                  <span class="n">Reshape</span>
                                     <span class="o">|</span>
                      <span class="o">+--------------+--------------+</span>
                      <span class="o">|</span>                             <span class="o">|</span>
                      <span class="n">v</span>                             <span class="n">v</span>
                <span class="p">[</span><span class="n">cos_cache</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Gather</span>       <span class="p">[</span><span class="n">sin_cache</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Gather</span>
                                  <span class="o">|</span>                             <span class="o">|</span>
                                  <span class="n">v</span>                             <span class="n">v</span>
                               <span class="n">Reshape</span>                       <span class="n">Reshape</span>
                                  <span class="o">|</span>                             <span class="o">|</span>
<span class="p">[</span><span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Split</span> <span class="o">----------------+-----------------------------+</span>
              <span class="o">|</span>       <span class="o">|</span>                             <span class="o">|</span>
              <span class="n">v</span>       <span class="n">v</span>                             <span class="n">v</span>
            <span class="n">real</span>    <span class="n">imag</span>                         <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span>
              <span class="o">|</span>       <span class="o">|</span>                             <span class="o">|</span>
              <span class="o">+-------+-----------------------------+</span>
              <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>          <span class="o">|</span>          <span class="o">|</span>
              <span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>          <span class="n">v</span>          <span class="n">v</span>
            <span class="n">Mul</span>     <span class="n">Mul</span>     <span class="n">Mul</span>        <span class="n">Mul</span>      <span class="p">(</span><span class="n">RoPE</span><span class="p">)</span>
              <span class="o">|</span>       <span class="o">|</span>       <span class="o">|</span>          <span class="o">|</span>
              <span class="n">v</span>       <span class="n">v</span>       <span class="n">v</span>          <span class="n">v</span>
            <span class="n">Sub</span> <span class="o">&lt;-----+</span>     <span class="n">Add</span> <span class="o">&lt;--------+</span>
              <span class="o">|</span>               <span class="o">|</span>
              <span class="n">v</span>               <span class="n">v</span>
            <span class="n">real</span><span class="s1">&#39;           imag&#39;</span>
              <span class="o">|</span>               <span class="o">|</span>
              <span class="o">+-------+-------+</span>
                      <span class="o">|</span>
                   <span class="n">Concat</span>
                      <span class="o">|</span>
                      <span class="n">v</span>
                  <span class="p">[</span><span class="n">Output</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="rmsnormtol2norm">
<h3><code class="docutils literal notranslate"><span class="pre">RMSNormToL2Norm</span></code><a class="headerlink" href="#rmsnormtol2norm" title="Link to this heading">#</a></h3>
<section id="id33">
<h4>Description<a class="headerlink" href="#id33" title="Link to this heading">#</a></h4>
<p>Replace RMSNorm subgraph with L2Norm subgraph.</p>
</section>
<section id="id34">
<h4>Example<a class="headerlink" href="#id34" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">RMSNorm</span> <span class="n">pattern</span><span class="p">:</span>
    <span class="o">+-----------------------------------------------+</span>
    <span class="o">|</span>                                               <span class="o">|</span>
    <span class="o">|</span>                                               <span class="n">v</span>
<span class="p">[</span><span class="n">Root</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Pow</span> <span class="o">--&gt;</span> <span class="n">ReduceMean</span> <span class="o">--&gt;</span> <span class="n">Add</span> <span class="o">--&gt;</span> <span class="n">Sqrt</span> <span class="o">--&gt;</span> <span class="n">Div</span> <span class="o">--&gt;</span> <span class="n">Mul</span>
          <span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>     <span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>   <span class="p">(</span><span class="n">B</span><span class="o">=</span><span class="n">E</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RMSNormToL2Norm&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Root</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">LpNormalization</span> <span class="o">--&gt;</span> <span class="n">Mul</span>
           <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="simplifiedlayernormtol2norm">
<h3><code class="docutils literal notranslate"><span class="pre">SimplifiedLayerNormToL2Norm</span></code><a class="headerlink" href="#simplifiedlayernormtol2norm" title="Link to this heading">#</a></h3>
<section id="id35">
<h4>Description<a class="headerlink" href="#id35" title="Link to this heading">#</a></h4>
<p>Replace Skip/SimplifiedLayerNormalization nodes with L2Norm subgraph.</p>
</section>
<section id="id36">
<h4>Example<a class="headerlink" href="#id36" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SimplifiedLayerNorm</span> <span class="n">pattern</span><span class="p">:</span>
<span class="p">[</span><span class="n">Root</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">SimplifiedLayerNormalization</span>
             <span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>

<span class="n">SkipSimpleLayerNorm</span> <span class="n">pattern</span><span class="p">:</span>
<span class="p">[</span><span class="n">Root1</span><span class="p">]</span> <span class="o">------------+</span>
                    <span class="n">v</span>
<span class="p">[</span><span class="n">Root2</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">SkipSimpleLayerNormalization</span>
               <span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;SimplifiedLayerNormToL2Norm&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Root</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">LpNormalization</span> <span class="o">-&gt;</span> <span class="n">Mul</span>
           <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

<span class="p">[</span><span class="n">Root1</span><span class="p">]</span> <span class="o">-------&gt;</span> <span class="n">Add</span>
                  <span class="o">|</span>
                  <span class="n">v</span>
<span class="p">[</span><span class="n">Root2</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">LpNormalization</span> <span class="o">--&gt;</span> <span class="n">Mul</span>
            <span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="matmuladdtogemm">
<h3><code class="docutils literal notranslate"><span class="pre">MatMulAddToGemm</span></code><a class="headerlink" href="#matmuladdtogemm" title="Link to this heading">#</a></h3>
<section id="id37">
<h4>Description<a class="headerlink" href="#id37" title="Link to this heading">#</a></h4>
<p>Replace MatMul + Add with Gemm.</p>
<p>Second MatMul input must be a 2D tensor and the other input of the Add node must be a 1D tensor. If the first MatMul input is more than 2D and the shapes are static, it is reshaped to 2D before the Gemm node and reshaped back to the original shape after the Gemm node.</p>
</section>
<section id="id38">
<h4>Example<a class="headerlink" href="#id38" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Static</span><span class="o">/</span><span class="n">Dynamic</span> <span class="n">shaped</span> <span class="nb">input</span><span class="p">:</span>
             <span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">weight</span><span class="p">]</span>   <span class="p">[</span><span class="mi">1</span><span class="n">D</span> <span class="n">bias</span><span class="p">]</span>
                 <span class="o">|</span>            <span class="o">|</span>
                 <span class="n">v</span>            <span class="n">v</span>
<span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">MatMul</span> <span class="o">-----&gt;</span> <span class="n">Add</span>

<span class="n">Static</span> <span class="n">shaped</span> <span class="nb">input</span><span class="p">:</span>
             <span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">weight</span><span class="p">]</span>    <span class="p">[</span><span class="mi">1</span><span class="n">D</span> <span class="n">bias</span><span class="p">]</span>
                 <span class="o">|</span>             <span class="o">|</span>
                 <span class="n">v</span>             <span class="n">v</span>
<span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">D</span> <span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">MatMul</span> <span class="o">-----&gt;</span> <span class="n">Add</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MatMulAddToGemm&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Static</span><span class="o">/</span><span class="n">Dynamic</span> <span class="n">shaped</span> <span class="n">inputs</span><span class="p">:</span>
             <span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">weight</span><span class="p">]</span>
                 <span class="o">|</span>
                 <span class="n">v</span>
<span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Gemm</span> <span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
                 <span class="o">^</span>
                 <span class="o">|</span>
              <span class="p">[</span><span class="mi">1</span><span class="n">D</span> <span class="n">bias</span><span class="p">]</span>

<span class="n">Static</span> <span class="n">shaped</span> <span class="n">inputs</span><span class="p">:</span>
                          <span class="p">[</span><span class="mi">2</span><span class="n">D</span> <span class="n">weight</span><span class="p">]</span>
                              <span class="o">|</span>
                              <span class="n">v</span>
<span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">D</span> <span class="n">Input</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="n">Reshape</span> <span class="o">--&gt;</span> <span class="n">Gemm</span> <span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">--&gt;</span> <span class="n">Reshape</span>
                              <span class="o">^</span>
                              <span class="o">|</span>
                          <span class="p">[</span><span class="mi">1</span><span class="n">D</span> <span class="n">bias</span><span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="replaceattentionmaskvalue">
<h3><code class="docutils literal notranslate"><span class="pre">ReplaceAttentionMaskValue</span></code><a class="headerlink" href="#replaceattentionmaskvalue" title="Link to this heading">#</a></h3>
<section id="id39">
<h4>Description<a class="headerlink" href="#id39" title="Link to this heading">#</a></h4>
<p>Replace the value of extended attention mask with a new value. This surgery is useful if the default mask value does not quantize well due to numerical instability.</p>
</section>
<section id="id40">
<h4>Example<a class="headerlink" href="#id40" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;output1&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;ConstantOfShape&quot;</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;ConstantOfShape&quot;</span>
    <span class="n">attribute</span> <span class="p">{</span>
      <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
      <span class="n">t</span> <span class="p">{</span>
        <span class="n">dims</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.4028234663852886e+38</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">TENSOR</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;Constant_output&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Constant&quot;</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Constant&quot;</span>
    <span class="n">attribute</span> <span class="p">{</span>
      <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
      <span class="n">t</span> <span class="p">{</span>
        <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.4028234663852886e+38</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">TENSOR</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">initializer</span> <span class="p">{</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">3.4028234663852886e+38</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;init&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReplaceAttentionMaskValue&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;output1&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;ConstantOfShape&quot;</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;ConstantOfShape&quot;</span>
    <span class="n">attribute</span> <span class="p">{</span>
      <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
      <span class="n">t</span> <span class="p">{</span>
        <span class="n">dims</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">10000.0</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">TENSOR</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;Constant_output&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;Constant&quot;</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Constant&quot;</span>
    <span class="n">attribute</span> <span class="p">{</span>
      <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;value&quot;</span>
      <span class="n">t</span> <span class="p">{</span>
        <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
        <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">10000.0</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
      <span class="nb">type</span><span class="p">:</span> <span class="n">TENSOR</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">initializer</span> <span class="p">{</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="mi">1</span>
    <span class="n">float_data</span><span class="p">:</span> <span class="o">-</span><span class="mf">10000.0</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;init&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removeqdq">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveQDQ</span></code><a class="headerlink" href="#removeqdq" title="Link to this heading">#</a></h3>
<section id="id41">
<h4>Description<a class="headerlink" href="#id41" title="Link to this heading">#</a></h4>
<p>Remove QuantizeLinear and DequantizeLinear node pairs from the graph. Finds Q-&gt;DQ patterns and removes them, directly connecting their inputs/outputs. Optionally keeps Clip nodes after graph inputs for value range constraints.</p>
</section>
<section id="id42">
<h4>Configurations<a class="headerlink" href="#id42" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">keep_clip_after_inputs</span></code>: Whether to keep Clip nodes after graph inputs (default: false).</p></li>
</ul>
</section>
<section id="id43">
<h4>Example<a class="headerlink" href="#id43" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;QuantizeLinear&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_point&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;quantized&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;DequantizeLinear&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;quantized&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_point&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dequantized&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;dequantized&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveQDQ&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;keep_clip_after_inputs&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="qdqtoclip">
<h3><code class="docutils literal notranslate"><span class="pre">QDQToClip</span></code><a class="headerlink" href="#qdqtoclip" title="Link to this heading">#</a></h3>
<section id="id44">
<h4>Description<a class="headerlink" href="#id44" title="Link to this heading">#</a></h4>
<p>Replace QuantizeLinear-DequantizeLinear pairs with Clip operations. Converts Q-&gt;DQ patterns to Clip nodes with computed min/max values based on quantization scale and zero point, maintaining the same value constraints.</p>
</section>
<section id="id45">
<h4>Example<a class="headerlink" href="#id45" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;QuantizeLinear&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_point&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;quantized&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;DequantizeLinear&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;quantized&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="s2">&quot;zero_point&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;scale&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">)</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;zero_point&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="mi">128</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;QDQToClip&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Clip&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;clip_min&quot;</span><span class="p">,</span> <span class="s2">&quot;clip_max&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;clip_min&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mf">12.8</span><span class="p">)</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;clip_max&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="mf">12.7</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="matmultotransposeconvtranspose">
<h3><code class="docutils literal notranslate"><span class="pre">MatMulToTransposeConvTranspose</span></code><a class="headerlink" href="#matmultotransposeconvtranspose" title="Link to this heading">#</a></h3>
<section id="id46">
<h4>Description<a class="headerlink" href="#id46" title="Link to this heading">#</a></h4>
<p>Replace 2D Gemm/MatMul with Transpose and 1x1 Conv. When C==1, convert it to 1x1 Conv using TRANSPOSE + CONV + TRANSPOSE sequence for better DLA compatibility.</p>
</section>
<section id="id47">
<h4>Example<a class="headerlink" href="#id47" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MatMulToTransposeConvTranspose&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removeintermediarysqueezeandunsqueeze">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveIntermediarySqueezeAndUnsqueeze</span></code><a class="headerlink" href="#removeintermediarysqueezeandunsqueeze" title="Link to this heading">#</a></h3>
<section id="id48">
<h4>Description<a class="headerlink" href="#id48" title="Link to this heading">#</a></h4>
<p>Remove all Unsqueeze and Squeeze operations that arent directly connected to model inputs. This optimization removes unnecessary dimension expansion operations in the middle of the graph.</p>
</section>
<section id="id49">
<h4>Example<a class="headerlink" href="#id49" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveIntermediarySqueezeAndUnsqueeze&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removedeqlin">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveDeqLin</span></code><a class="headerlink" href="#removedeqlin" title="Link to this heading">#</a></h3>
<section id="id50">
<h4>Description<a class="headerlink" href="#id50" title="Link to this heading">#</a></h4>
<p>Remove DequantizeLinear nodes that operate on constant initializers. Dequantizes constant initializers at compile time and replaces DequantizeLinear nodes with the pre-computed float values, reducing runtime operations.</p>
</section>
<section id="id51">
<h4>Example<a class="headerlink" href="#id51" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveDeqLin&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dmodelinputs">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DModelInputs</span></code><a class="headerlink" href="#non4dmodelinputs" title="Link to this heading">#</a></h3>
<section id="id52">
<h4>Description<a class="headerlink" href="#id52" title="Link to this heading">#</a></h4>
<p>Add Unsqueeze node to model inputs if input is 2D or 3D. Ensures all model inputs are 4D by adding Unsqueeze operations:</p>
<ul class="simple">
<li><p>2D inputs: adds dimensions at positions [0, -1]</p></li>
<li><p>3D inputs: adds dimension at position <a class="reference external" href="https://onnxruntime.ai/docs/performance/quantization.html" title="ONNX Runtime Quantization">1</a></p></li>
</ul>
<p>Updates existing Unsqueeze nodes if present to maintain 4D output.</p>
</section>
<section id="id53">
<h4>Example<a class="headerlink" href="#id53" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># 2D input</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>  <span class="c1"># 3D input</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;weight1&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_out&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input2&quot;</span><span class="p">,</span> <span class="s2">&quot;bias&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_out&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DModelInputs&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input1&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># 2D input</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input2&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>  <span class="c1"># 3D input</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Unsqueeze&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1&quot;</span><span class="p">,</span> <span class="s2">&quot;input1_unsqueeze_axes&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1_unsqueeze_input&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Unsqueeze&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input2&quot;</span><span class="p">,</span> <span class="s2">&quot;input2_unsqueeze_axes&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input2_unsqueeze_input&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input1_unsqueeze_input&quot;</span><span class="p">,</span> <span class="s2">&quot;weight1&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_out&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Add&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input2_unsqueeze_input&quot;</span><span class="p">,</span> <span class="s2">&quot;bias&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;add_out&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;input1_unsqueeze_axes&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;input2_unsqueeze_axes&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dmodeloutputs">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DModelOutputs</span></code><a class="headerlink" href="#non4dmodeloutputs" title="Link to this heading">#</a></h3>
<section id="id54">
<h4>Description<a class="headerlink" href="#id54" title="Link to this heading">#</a></h4>
<p>Add Squeeze to non 4D model outputs. Ensures model outputs match expected dimensions by adding Squeeze operations:</p>
<ul class="simple">
<li><p>For 2D outputs: squeeze dimensions [0, 3] or [0, 1]</p></li>
<li><p>For 3D outputs: squeeze dimension <a class="reference external" href="https://onnxruntime.ai/docs/performance/quantization.html#dynamic-quantization" title="Dynamic Quantization">2</a></p></li>
</ul>
<p>Handles special case of Squeeze-&gt;Clip-&gt;Output pattern.</p>
</section>
<section id="id55">
<h4>Example<a class="headerlink" href="#id55" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DModelOutputs&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="standalonereducesum">
<h3><code class="docutils literal notranslate"><span class="pre">StandaloneReduceSum</span></code><a class="headerlink" href="#standalonereducesum" title="Link to this heading">#</a></h3>
<section id="id56">
<h4>Description<a class="headerlink" href="#id56" title="Link to this heading">#</a></h4>
<p>Modifies standalone ReduceSum operations (not already transformed) to:</p>
<ul class="simple">
<li><p>Set keepdims=1 to preserve dimensions</p></li>
<li><p>Change reduction axis from <a class="reference external" href="https://onnxruntime.ai/docs/performance/quantization.html" title="ONNX Runtime Quantization">1</a> to <a class="reference external" href="https://onnxruntime.ai/docs/performance/quantization.html#dynamic-quantization" title="Dynamic Quantization">2</a> for DLA compatibility</p></li>
<li><p>Skip if axes is already [-1] (reduce last dimension)</p></li>
</ul>
</section>
<section id="id57">
<h4>Example<a class="headerlink" href="#id57" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;StandaloneReduceSum&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="gather">
<h3><code class="docutils literal notranslate"><span class="pre">Gather</span></code><a class="headerlink" href="#gather" title="Link to this heading">#</a></h3>
<section id="id58">
<h4>Description<a class="headerlink" href="#id58" title="Link to this heading">#</a></h4>
<p>Transforms Gather operations for DLA compatibility:</p>
<ul class="simple">
<li><p>Converts scalar indices to 1D vector format</p></li>
<li><p>Updates axis attribute from 1 to 2 when needed</p></li>
<li><p>Ensures indices are always in array format</p></li>
</ul>
</section>
<section id="id59">
<h4>Example<a class="headerlink" href="#id59" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Gather&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="gatherelements">
<h3><code class="docutils literal notranslate"><span class="pre">GatherElements</span></code><a class="headerlink" href="#gatherelements" title="Link to this heading">#</a></h3>
<section id="id60">
<h4>Description<a class="headerlink" href="#id60" title="Link to this heading">#</a></h4>
<p>Transforms GatherElements operations for DLA compatibility:</p>
<ul class="simple">
<li><p>Converts scalar indices to 1D vector format</p></li>
<li><p>Reshapes 3D indices to 4D by adding dimension at front</p></li>
<li><p>Ensures indices match expected tensor format</p></li>
</ul>
</section>
<section id="id61">
<h4>Example<a class="headerlink" href="#id61" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GatherElements&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dinitializers">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DInitializers</span></code><a class="headerlink" href="#non4dinitializers" title="Link to this heading">#</a></h3>
<section id="id62">
<h4>Description<a class="headerlink" href="#id62" title="Link to this heading">#</a></h4>
<p>Expand non-4D initializers to 4D format for DLA compatibility:</p>
<ul class="simple">
<li><p>1D [K]  [111K] for Div/Sub/Mul operations</p></li>
<li><p>2D [CK]  [KC11] (transpose and reshape) for most operations</p></li>
<li><p>2D [K,C]  [1,1,K,C] for Gemm operations</p></li>
<li><p>3D  4D by adding dimension at front</p></li>
</ul>
<p>Skips MatMul inputs and only expands initializers used by specific operations.</p>
</section>
<section id="id63">
<h4>Example<a class="headerlink" href="#id63" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;scale&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">]</span>  <span class="c1"># 1D</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># 2D</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DInitializers&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Mul&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;scale&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;scale&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>  <span class="c1"># 1D -&gt; 4D</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;weight&quot;</span> <span class="n">shape</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># 2D -&gt; 4D (transposed)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="removealltensorvalueshapes">
<h3><code class="docutils literal notranslate"><span class="pre">RemoveAllTensorValueShapes</span></code><a class="headerlink" href="#removealltensorvalueshapes" title="Link to this heading">#</a></h3>
<section id="id64">
<h4>Description<a class="headerlink" href="#id64" title="Link to this heading">#</a></h4>
<p>Remove all tensor shape information from value_info. Clears shape fields from all value_info entries in the graph, useful for models where shape inference is not needed or causes issues.</p>
</section>
<section id="id65">
<h4>Example<a class="headerlink" href="#id65" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;RemoveAllTensorValueShapes&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dreshape">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DReshape</span></code><a class="headerlink" href="#non4dreshape" title="Link to this heading">#</a></h3>
<section id="id66">
<h4>Description<a class="headerlink" href="#id66" title="Link to this heading">#</a></h4>
<p>Convert 3D Reshape operations to 4D for DLA compatibility. Updates Reshape nodes with 3D target shapes to 4D by inserting 1 at the appropriate position (e.g., [-1, 512, 768] -&gt; [1, -1, 512, 768]).</p>
</section>
<section id="id67">
<h4>Example<a class="headerlink" href="#id67" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DReshape&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dexpand">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DExpand</span></code><a class="headerlink" href="#non4dexpand" title="Link to this heading">#</a></h3>
<section id="id68">
<h4>Description<a class="headerlink" href="#id68" title="Link to this heading">#</a></h4>
<p>Convert 3D Expand operations to 4D for DLA compatibility. Updates Expand nodes with 3D shapes to 4D by inserting 1 at dimension 0 (e.g., [2, 3, 4] -&gt; [1, 2, 3, 4]).</p>
</section>
<section id="id69">
<h4>Example<a class="headerlink" href="#id69" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DExpand&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dtranspose">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DTranspose</span></code><a class="headerlink" href="#non4dtranspose" title="Link to this heading">#</a></h3>
<section id="id70">
<h4>Description<a class="headerlink" href="#id70" title="Link to this heading">#</a></h4>
<p>Update Transpose permutation attributes for non-4D tensors. Adjusts perm attribute of Transpose nodes to handle 4D tensors:</p>
<ul class="simple">
<li><p>2D: [T0, T1] -&gt; [0, 1, T0 + 2, T1 + 2]</p></li>
<li><p>3D: [T0, T1, T2] -&gt; [0, T0 + 1, T1 + 1, T2 + 1]</p></li>
</ul>
<p>Ensures transpose operations work correctly when tensors are expanded to 4D.</p>
</section>
<section id="id71">
<h4>Example<a class="headerlink" href="#id71" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DTranspose&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dslice">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DSlice</span></code><a class="headerlink" href="#non4dslice" title="Link to this heading">#</a></h3>
<section id="id72">
<h4>Description<a class="headerlink" href="#id72" title="Link to this heading">#</a></h4>
<p>Transform Slice axes of non4D tensors. Updates Slice operations to work with 4D tensors:</p>
<ul class="simple">
<li><p>Changes axes from specific dimensions to [-1] (last dimension)</p></li>
<li><p>Only processes nodes not already transformed</p></li>
<li><p>Ensures slicing operations remain valid after tensor expansion</p></li>
</ul>
</section>
<section id="id73">
<h4>Example<a class="headerlink" href="#id73" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DSlice&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="non4dlpnorm">
<h3><code class="docutils literal notranslate"><span class="pre">Non4DLpNorm</span></code><a class="headerlink" href="#non4dlpnorm" title="Link to this heading">#</a></h3>
<section id="id74">
<h4>Description<a class="headerlink" href="#id74" title="Link to this heading">#</a></h4>
<p>Transform LpNormalization axes of non4D tensors. Updates LpNormalization operations for 4D tensor compatibility:</p>
<ul class="simple">
<li><p>Changes axis attribute to -1 (last dimension)</p></li>
<li><p>Ensures normalization occurs along the correct dimension after tensor expansion to 4D</p></li>
</ul>
</section>
<section id="id75">
<h4>Example<a class="headerlink" href="#id75" title="Link to this heading">#</a></h4>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Non4DLpNorm&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="flatten">
<h3><code class="docutils literal notranslate"><span class="pre">Flatten</span></code><a class="headerlink" href="#flatten" title="Link to this heading">#</a></h3>
<section id="id76">
<h4>Description<a class="headerlink" href="#id76" title="Link to this heading">#</a></h4>
<p>Replace Flatten operations with Reshape operations using shape [1, 1, 1, -1]. This maintains compatibility with DLA which may not support Flatten directly, while preserving the flattening behavior.</p>
</section>
<section id="id77">
<h4>Example<a class="headerlink" href="#id77" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Flatten&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;flattened&quot;</span><span class="p">]</span>
    <span class="n">axis</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Flatten&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Reshape&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;reshape_axes&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;flattened&quot;</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="s2">&quot;flatten_reshape&quot;</span>
  <span class="p">}</span>
  <span class="n">initializer</span><span class="p">:</span> <span class="s2">&quot;reshape_axes&quot;</span> <span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="addintermediatetensorstooutputs">
<h3><code class="docutils literal notranslate"><span class="pre">AddIntermediateTensorsToOutputs</span></code><a class="headerlink" href="#addintermediatetensorstooutputs" title="Link to this heading">#</a></h3>
<section id="id78">
<h4>Description<a class="headerlink" href="#id78" title="Link to this heading">#</a></h4>
<p>Debug function to add intermediate tensors to outputs. Exposes intermediate tensor values as model outputs for debugging:</p>
<ul class="simple">
<li><p>Can specify specific tensors to add via intermediate_tensor_to_add list</p></li>
<li><p>If not specified, adds all intermediate tensors from node outputs</p></li>
<li><p>Useful for inspecting values at different stages of the graph</p></li>
</ul>
</section>
<section id="id79">
<h4>Configurations<a class="headerlink" href="#id79" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">intermediate_tensor_to_add</span></code>: List of intermediate tensor names to expose as outputs.</p></li>
</ul>
</section>
<section id="id80">
<h4>Example<a class="headerlink" href="#id80" title="Link to this heading">#</a></h4>
<p>Initial model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_output&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu1_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu1_output&quot;</span><span class="p">,</span> <span class="s2">&quot;weight2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;final_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;final_output&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AddIntermediateTensorsToOutputs&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;intermediate_tensor_to_add&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;conv1_output&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;relu1_output&quot;</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed model graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="p">{</span>
  <span class="nb">input</span><span class="p">:</span> <span class="s2">&quot;input&quot;</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;input&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Relu&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;conv1_output&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu1_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">node</span> <span class="p">{</span>
    <span class="n">op_type</span><span class="p">:</span> <span class="s2">&quot;Conv&quot;</span>
    <span class="nb">input</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;relu1_output&quot;</span><span class="p">,</span> <span class="s2">&quot;weight2&quot;</span><span class="p">]</span>
    <span class="n">output</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;final_output&quot;</span><span class="p">]</span>
  <span class="p">}</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;final_output&quot;</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;conv1_output&quot;</span>    <span class="c1"># Added for debugging</span>
  <span class="n">output</span><span class="p">:</span> <span class="s2">&quot;relu1_output&quot;</span>     <span class="c1"># Added for debugging</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="reshapereducesum">
<h3><code class="docutils literal notranslate"><span class="pre">ReshapeReduceSum</span></code><a class="headerlink" href="#reshapereducesum" title="Link to this heading">#</a></h3>
<section id="id81">
<h4>Description<a class="headerlink" href="#id81" title="Link to this heading">#</a></h4>
<p>Transform Reshape-ReduceSum pattern to parallel Slice-ReduceSum-Concat for DLA. Splits a Reshape-ReduceSum operation into parallel paths to improve DLA performance:</p>
<ul class="simple">
<li><p>Replaces single Reshape-ReduceSum with two parallel Slice operations</p></li>
<li><p>Each slice processes part of the data with ReduceSum</p></li>
<li><p>Results are concatenated to produce the same output</p></li>
<li><p>Enables better parallelization on DLA hardware</p></li>
</ul>
</section>
<section id="id82">
<h4>Example<a class="headerlink" href="#id82" title="Link to this heading">#</a></h4>
<p>Initial pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">x</span><span class="p">,</span> <span class="n">shape</span>
        <span class="o">|</span>
    <span class="n">Reshape</span> <span class="n">axes</span>
        <span class="o">|</span>   <span class="o">/</span>
    <span class="n">ReduceSum</span>
        <span class="o">|</span>
    <span class="n">reducesum_output</span>
</pre></div>
</div>
<p>after applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReshapeReduceSum&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="n">x</span>
    <span class="o">/</span>        \
    <span class="n">Slice</span>      <span class="n">Slice</span>
    <span class="o">|</span>           <span class="o">|</span>
    <span class="n">ReduceSum</span>   <span class="n">ReduceSum</span>
        \       <span class="o">/</span>
        <span class="n">Concat</span>
        <span class="o">|</span>
    <span class="n">reducesum_output</span>
</pre></div>
</div>
</section>
</section>
<section id="reshapeclipreducesum">
<h3><code class="docutils literal notranslate"><span class="pre">ReshapeClipReduceSum</span></code><a class="headerlink" href="#reshapeclipreducesum" title="Link to this heading">#</a></h3>
<section id="id83">
<h4>Description<a class="headerlink" href="#id83" title="Link to this heading">#</a></h4>
<p>Transform Reshape-Clip-ReduceSum pattern to parallel paths for DLA optimization. Similar to ReshapeReduceSum but includes Clip operation:</p>
<ul class="simple">
<li><p>Splits Reshape-Clip-ReduceSum into two parallel processing paths</p></li>
<li><p>Each path: Slice -&gt; Clip -&gt; ReduceSum</p></li>
<li><p>Maintains numerical equivalence while improving DLA parallelization</p></li>
<li><p>Useful for quantized models where Clip enforces value ranges</p></li>
</ul>
</section>
<section id="id84">
<h4>Example<a class="headerlink" href="#id84" title="Link to this heading">#</a></h4>
<p>Initial pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="o">|</span>
    <span class="n">Reshape</span>
        <span class="o">|</span>
    <span class="n">Clip</span>
        <span class="o">|</span>
    <span class="n">ReduceSum</span>
        <span class="o">|</span>
    <span class="p">(</span><span class="n">reducesum_output</span><span class="p">)</span>
</pre></div>
</div>
<p>after applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReshapeClipReduceSum&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="o">/</span>        \
    <span class="n">Slice</span>      <span class="n">Slice</span>
    <span class="o">|</span>           <span class="o">|</span>
    <span class="n">Clip</span>        <span class="n">Clip</span>
    <span class="o">|</span>           <span class="o">|</span>
    <span class="n">ReduceSum</span>   <span class="n">ReduceSum</span>
        \\       <span class="o">/</span>
        <span class="n">Concat</span>
        <span class="o">|</span>
    <span class="p">(</span><span class="n">reducesum_output</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="reducemax">
<h3><code class="docutils literal notranslate"><span class="pre">ReduceMax</span></code><a class="headerlink" href="#reducemax" title="Link to this heading">#</a></h3>
<section id="id85">
<h4>Description<a class="headerlink" href="#id85" title="Link to this heading">#</a></h4>
<p>Add Reshape after ReduceMax operations for DLA compatibility. Modifies ReduceMax operations to ensure output shape compatibility:</p>
<ul class="simple">
<li><p>Adds a Reshape node after ReduceMax with shape [1,1,1,3600]</p></li>
<li><p>Updates axes to <a class="reference external" href="https://onnxruntime.ai/docs/performance/quantization.html#static-quantization" title="Static Quantization">3</a> and keepdims to 1</p></li>
<li><p>Ensures ReduceMax output has the expected 4D shape for DLA</p></li>
<li><p>Hardcoded output shape may need adjustment for different models</p></li>
</ul>
</section>
<section id="id86">
<h4>Example<a class="headerlink" href="#id86" title="Link to this heading">#</a></h4>
<p>Initial pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">data</span>   <span class="n">axes</span>   <span class="n">keepdims</span>
        <span class="o">|</span>   <span class="o">/</span>     <span class="o">/</span>
    <span class="n">ReduceMax</span>
        <span class="o">|</span>
    <span class="n">reducemax_output</span>
</pre></div>
</div>
<p>after applying:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;GraphSurgeries&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;surgeries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;surgeon&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ReduceMax&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Transformed pattern:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">data</span>   <span class="n">axes</span>   <span class="n">keepdims</span>
        <span class="o">|</span>   <span class="o">/</span>     <span class="o">/</span>
    <span class="n">ReduceMax</span>
        <span class="o">|</span>    <span class="n">reshape_shape</span>
        <span class="o">|</span>   <span class="o">/</span>
    <span class="n">Reshape</span>
        <span class="o">|</span>
    <span class="n">reducemax_output</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="append-pre-post-processing-ops">
<h2>Append Pre/Post Processing Ops<a class="headerlink" href="#append-pre-post-processing-ops" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">AppendPrePostProcessingOps</span></code> inserts pre and post processing ops into the ONNX graph.</p>
<section id="id87">
<h3>Example Configuration<a class="headerlink" href="#id87" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AppendPrePostProcessingOps&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tool_command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;superresolution&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;tool_command_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;output_format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;png&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">AppendPrePostProcessingOps</span></code> also supports pre/post processing ops by leveraging the <a class="reference external" href="https://github.com/microsoft/onnxruntime-extensions/tree/main/onnxruntime_extensions/tools/pre_post_processing/steps">onnxruntime-extension steps</a> and <code class="docutils literal notranslate"><span class="pre">PrePostProcessor</span></code>.
You can refer to <a class="reference external" href="https://github.com/microsoft/onnxruntime-extensions/blob/main/onnxruntime_extensions/tools/Example%20usage%20of%20the%20PrePostProcessor.md">here</a> to see how to leverage <code class="docutils literal notranslate"><span class="pre">PrePostProcessor</span></code> to customize pre and post processing ops.</p>
<ul class="simple">
<li><p>Olive introduces two placeholders to represent the model input/output shape dimension value: <code class="docutils literal notranslate"><span class="pre">__model_input__</span></code> and <code class="docutils literal notranslate"><span class="pre">__model_output__</span></code>.</p></li>
<li><p>To support the IoMapEntry, the step need choose use the full form. For example:</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&quot;YCbCrToPixels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BGR&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;io_map&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">[</span><span class="s2">&quot;Y1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span><span class="s2">&quot;Cb1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span>
<span class="w">            </span><span class="p">[</span><span class="s2">&quot;Cr1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">    </span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">tool_command_args</span></code> will be used to describe the input parameters to create the <code class="docutils literal notranslate"><span class="pre">PrePostProcessor</span></code> instance. It is list of <code class="docutils literal notranslate"><span class="pre">PrePostProcessorInput</span></code>.
The <code class="docutils literal notranslate"><span class="pre">name</span></code> is the tensor name. The <code class="docutils literal notranslate"><span class="pre">data_type</span></code> and <code class="docutils literal notranslate"><span class="pre">shape</span></code> will be used to create the tensor type. The <code class="docutils literal notranslate"><span class="pre">shape</span></code> can be a list of integers or a list of string.</p></li>
</ul>
<p>Users that write their own pre/post processing steps need to have the knowledge about whether the step includes the operators that is built-in support or supported in onnxruntime-extensions.
For example, for some ops like <code class="docutils literal notranslate"><span class="pre">ConvertImageToBGR</span></code> which requires other extensions may be incompatible with ort-web, user need to exclude this kind of ops to generate proper models.</p>
<p>Here are some examples to describe the pre/post processing which is exactly same with <a class="reference external" href="https://github.com/microsoft/onnxruntime-extensions/blob/main/onnxruntime_extensions/tools/add_pre_post_processing_to_model.py#L89">superresolution</a></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;pre&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;ConvertImageToBGR&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Resize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;resize_to&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_input__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;input_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_input__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;input_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;CenterCrop&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;height&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_input__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;input_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;width&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_input__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;input_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;PixelsToYCbCr&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BGR&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;ImageBytesToFloat&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{}},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;Unsqueeze&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;axes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]}},</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;post&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;Squeeze&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;axes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]}},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;FloatToImageBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Y1_uint8&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Resize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;resize_to&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_output__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;output_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">},</span>
<span class="w">                        </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_output__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;output_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">                    </span><span class="p">],</span>
<span class="w">                    </span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HW&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;io_map&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="s2">&quot;PixelsToYCbCr&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]],</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;FloatToImageBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;multiplier&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cb1_uint8&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Resize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;resize_to&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                        </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_output__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;output_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-2</span><span class="p">},</span>
<span class="w">                        </span><span class="p">{</span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;__model_output__&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;output_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;dim_index&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">},</span>
<span class="w">                    </span><span class="p">],</span>
<span class="w">                    </span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;HW&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;io_map&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[[</span><span class="s2">&quot;PixelsToYCbCr&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]],</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;FloatToImageBytes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;multiplier&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cr1_uint8&quot;</span><span class="p">}},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;YCbCrToPixels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nt">&quot;layout&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BGR&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nt">&quot;io_map&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">[</span><span class="s2">&quot;Y1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span>
<span class="w">                    </span><span class="p">[</span><span class="s2">&quot;Cb1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">],</span>
<span class="w">                    </span><span class="p">[</span><span class="s2">&quot;Cr1_uint8&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">],</span>
<span class="w">                </span><span class="p">],</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span><span class="nt">&quot;ConvertBGRToImage&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;image_format&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;png&quot;</span><span class="p">}},</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;tool_command_args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;data_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uint8&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;shape&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;num_bytes&quot;</span><span class="p">],</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;target_opset&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="ort-performance-tuning">
<h2>ORT Performance Tuning<a class="headerlink" href="#ort-performance-tuning" title="Link to this heading">#</a></h2>
<p>ONNX Runtime provides high performance across a range of hardware options through its Execution Providers interface for different execution
environments.
For each model running with each execution provider, there are settings that can be tuned (e.g. thread number, execution mode, etc) to
improve performance.
<code class="docutils literal notranslate"><span class="pre">OrtSessionParamsTuning</span></code> covers basic knobs that can be leveraged to find the best performance for your model and hardware.</p>
<section id="id88">
<h3>Example Configuration<a class="headerlink" href="#id88" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OrtSessionParamsTuning&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data_config&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;session_params_tuning_data_config&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;batch_size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;providers_list&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">[</span>
<span class="w">            </span><span class="s2">&quot;CUDAExecutionProvider&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="nt">&quot;device_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;arena_extend_strategy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kNextPowerOfTwo&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;gpu_mem_limit&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2147483648</span><span class="p">,</span><span class="w"> </span><span class="c1">// 2 * 1024 * 1024 * 1024,</span>
<span class="w">                </span><span class="nt">&quot;cudnn_conv_algo_search&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;EXHAUSTIVE&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nt">&quot;do_copy_in_default_stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="s2">&quot;CPUExecutionProvider&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;enable_profiling&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Check out <a class="reference external" href="https://github.com/microsoft/Olive/blob/main/examples/bert/user_script.py">this file</a>
for an example implementation of <code class="docutils literal notranslate"><span class="pre">&quot;user_script.py&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;calib_data_config/dataloader_config/type&quot;</span></code>.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="model-splitting.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model Splitting</p>
      </div>
    </a>
    <a class="right-next"
       href="peft-adapters.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">PEFT Adapters</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#peeophole-optimizer">Peeophole Optimizer</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-configuration">Example Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ort-transformers-optimization">ORT Transformers Optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#onnx-surgeries">ONNX Surgeries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#renameinputs"><code class="docutils literal notranslate"><span class="pre">RenameInputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configurations">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#renameoutputs"><code class="docutils literal notranslate"><span class="pre">RenameOutputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#infershapes"><code class="docutils literal notranslate"><span class="pre">InferShapes</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removeshapes"><code class="docutils literal notranslate"><span class="pre">RemoveShapes</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removeinitializerfrominputs"><code class="docutils literal notranslate"><span class="pre">RemoveInitializerFromInputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reorderinputs"><code class="docutils literal notranslate"><span class="pre">ReorderInputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replaceerfwithtanh"><code class="docutils literal notranslate"><span class="pre">ReplaceErfWithTanh</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id15">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#zerooutinput"><code class="docutils literal notranslate"><span class="pre">ZeroOutInput</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removeinputs"><code class="docutils literal notranslate"><span class="pre">RemoveInputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id22">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposeoutputs"><code class="docutils literal notranslate"><span class="pre">ExposeOutputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id23">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id24">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id25">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposequantizedoutput"><code class="docutils literal notranslate"><span class="pre">ExposeQuantizedOutput</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id26">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id27">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id28">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposequickgelu"><code class="docutils literal notranslate"><span class="pre">DecomposeQuickGelu</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id29">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id30">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposerotaryembedding"><code class="docutils literal notranslate"><span class="pre">DecomposeRotaryEmbedding</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id31">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id32">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rmsnormtol2norm"><code class="docutils literal notranslate"><span class="pre">RMSNormToL2Norm</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id33">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id34">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifiedlayernormtol2norm"><code class="docutils literal notranslate"><span class="pre">SimplifiedLayerNormToL2Norm</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id35">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id36">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matmuladdtogemm"><code class="docutils literal notranslate"><span class="pre">MatMulAddToGemm</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id37">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id38">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#replaceattentionmaskvalue"><code class="docutils literal notranslate"><span class="pre">ReplaceAttentionMaskValue</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id39">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id40">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removeqdq"><code class="docutils literal notranslate"><span class="pre">RemoveQDQ</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id41">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id42">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id43">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#qdqtoclip"><code class="docutils literal notranslate"><span class="pre">QDQToClip</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id44">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id45">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#matmultotransposeconvtranspose"><code class="docutils literal notranslate"><span class="pre">MatMulToTransposeConvTranspose</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id46">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id47">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removeintermediarysqueezeandunsqueeze"><code class="docutils literal notranslate"><span class="pre">RemoveIntermediarySqueezeAndUnsqueeze</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id48">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id49">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removedeqlin"><code class="docutils literal notranslate"><span class="pre">RemoveDeqLin</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id50">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id51">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dmodelinputs"><code class="docutils literal notranslate"><span class="pre">Non4DModelInputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id52">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id53">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dmodeloutputs"><code class="docutils literal notranslate"><span class="pre">Non4DModelOutputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id54">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id55">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standalonereducesum"><code class="docutils literal notranslate"><span class="pre">StandaloneReduceSum</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id56">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id57">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gather"><code class="docutils literal notranslate"><span class="pre">Gather</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id58">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id59">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gatherelements"><code class="docutils literal notranslate"><span class="pre">GatherElements</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id60">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id61">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dinitializers"><code class="docutils literal notranslate"><span class="pre">Non4DInitializers</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id62">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id63">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#removealltensorvalueshapes"><code class="docutils literal notranslate"><span class="pre">RemoveAllTensorValueShapes</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id64">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id65">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dreshape"><code class="docutils literal notranslate"><span class="pre">Non4DReshape</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id66">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id67">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dexpand"><code class="docutils literal notranslate"><span class="pre">Non4DExpand</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id68">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id69">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dtranspose"><code class="docutils literal notranslate"><span class="pre">Non4DTranspose</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id70">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id71">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dslice"><code class="docutils literal notranslate"><span class="pre">Non4DSlice</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id72">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id73">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non4dlpnorm"><code class="docutils literal notranslate"><span class="pre">Non4DLpNorm</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id74">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id75">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#flatten"><code class="docutils literal notranslate"><span class="pre">Flatten</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id76">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id77">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#addintermediatetensorstooutputs"><code class="docutils literal notranslate"><span class="pre">AddIntermediateTensorsToOutputs</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id78">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id79">Configurations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id80">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reshapereducesum"><code class="docutils literal notranslate"><span class="pre">ReshapeReduceSum</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id81">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id82">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reshapeclipreducesum"><code class="docutils literal notranslate"><span class="pre">ReshapeClipReduceSum</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id83">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id84">Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reducemax"><code class="docutils literal notranslate"><span class="pre">ReduceMax</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id85">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id86">Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#append-pre-post-processing-ops">Append Pre/Post Processing Ops</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id87">Example Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ort-performance-tuning">ORT Performance Tuning</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id88">Example Configuration</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2023-2025, Olive Dev team.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>