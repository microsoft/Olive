
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to add new optimization Pass &#8212; Olive  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/css/header.css?v=5dcc4e7b" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'extending/how-to-add-optimization-pass';</script>
    <script src="../_static/js/custom_version.js?v=3856a39b"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to extend Olive to add custom model evaluator" href="custom-model-evaluator.html" />
    <link rel="prev" title="Design" href="design.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.9.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class=" navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Olive  documentation</p>
  
</a></div>
    
  </div>
  
  <div class=" navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../why-olive.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting-started/getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to/index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../features/index.html">
    Features
  </a>
</li>


<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class=" current active">
  <a class="nav-link dropdown-item nav-internal" href="index.html">
    Extending Olive
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/microsoft/Olive" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/olive-ai" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../why-olive.html">
    Overview
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting-started/getting-started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../how-to/index.html">
    How-to
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../examples.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../features/index.html">
    Features
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Extending Olive
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/microsoft/Olive" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/olive-ai" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Extending Olive</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">How to add new optimization Pass</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="how-to-add-new-optimization-pass">
<h1>How to add new optimization Pass<a class="headerlink" href="#how-to-add-new-optimization-pass" title="Link to this heading">#</a></h1>
<p>Olive provides simple interface to introduce new model optimization techniques. Each optimization technique is
represented as a Pass in Olive.</p>
<p>To introduce a new Pass follow these 3 steps.</p>
<section id="define-a-new-class">
<h2>1. Define a new class<a class="headerlink" href="#define-a-new-class" title="Link to this heading">#</a></h2>
<p>Define a new class using Pass as the base class. For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">olive.passes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NewOptimizationTrick</span><span class="p">(</span><span class="n">Pass</span><span class="p">):</span>
    <span class="c1"># Add any required data members to the class</span>
</pre></div>
</div>
</section>
<section id="define-configuration">
<h2>2. Define configuration<a class="headerlink" href="#define-configuration" title="Link to this heading">#</a></h2>
<p>Next, define the options used to configure this new technique by defining static method <code class="docutils literal notranslate"><span class="pre">_default_config</span></code>. This method
takes an <code class="docutils literal notranslate"><span class="pre">AcceleratorSpec</span></code> as input and returns <code class="docutils literal notranslate"><span class="pre">Dict[str,</span> <span class="pre">PassConfigParam]</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">AcceleratorSpec</span></code> is a dataclass that holds the information about the accelerator. The dataclass has the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">accelerator_type</span></code>: type of the accelerator. For example, <code class="docutils literal notranslate"><span class="pre">CPU</span></code>, <code class="docutils literal notranslate"><span class="pre">GPU</span></code> etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">execution_provider</span></code>: execution provider for the accelerator. For example, <code class="docutils literal notranslate"><span class="pre">CPUExecutionProvider</span></code>, <code class="docutils literal notranslate"><span class="pre">CUDAExecutionProvider</span></code> etc.
Please note if user specify some execution providers that don’t belong to the installed onnxruntime, these execution providers
will be ignored. For example, if user specify CUDA, TensorRT, DML execution provider, but the onnxruntime-gpu is installed then
the DML execution provider will be ignored since it is only available in onnxruntime-directml package.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">PassConfigParam</span></code> is a dataclass that holds the information about the configuration option. The dataclass has the following fields:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type_</span></code> : type of the parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">required</span></code> : whether the parameter is required</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">category</span></code>: The param category. It could be the following values:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">object</span></code> : whether the parameter is an object/function. If so, this parameter accepts the object or a string with the
name of the object in the user script. The type must include <code class="docutils literal notranslate"><span class="pre">str</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">path</span></code> : whether the parameter is a path. If so, this file/folder will be uploaded to the host system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: whether the parameter is a data path, which will be used to do data path normalization based on the data root.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">description</span></code> : description of the parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default_value</span></code>: default value for the parameter. This value is used as the default when not searching or when there are no searchable values.
Must be the same type as the parameter or a ConditionalDefault SearchParameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">search_defaults</span></code>: default search values for the parameter. This value is used as the default when searching.
Must be a Categorical or Conditional SearchParameter.</p></li>
</ul>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_default_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">accelerator_spec</span><span class="p">:</span> <span class="n">AcceleratorSpec</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PassConfigParam</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="c1"># required parameter</span>
            <span class="s2">&quot;param1&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span><span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param1 description&quot;</span><span class="p">),</span>
            <span class="c1"># optional parameter with default value</span>
            <span class="s2">&quot;param2&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span><span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param2 description&quot;</span><span class="p">),</span>
            <span class="c1"># optional parameter with default value and searchable values</span>
            <span class="s2">&quot;param3&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span>
                <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">search_defaults</span><span class="o">=</span><span class="n">Categorical</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param3 description&quot;</span>
            <span class="p">),</span>
            <span class="c1"># optional parameter with `category` set to `object`</span>
            <span class="c1"># the value of this parameter can be a string or a function that takes a string and returns the object,</span>
            <span class="c1"># say a class ObjectClass</span>
            <span class="s2">&quot;param4&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span>
                <span class="n">type_</span><span class="o">=</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Pass</span><span class="p">]],</span> <span class="n">category</span><span class="o">=</span><span class="n">ParamCategory</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param4 description&quot;</span>
            <span class="p">),</span>
            <span class="c1"># optional parameter with default_value that depends on another parameter value</span>
            <span class="s2">&quot;param5&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span>
                <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                <span class="n">default_value</span><span class="o">=</span><span class="n">ConditionalDefault</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="s2">&quot;param2&quot;</span><span class="p">,</span> <span class="n">support</span><span class="o">=</span><span class="p">{(</span><span class="mi">1</span><span class="p">,):</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,):</span> <span class="mi">3</span><span class="p">},</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param5 description&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="c1"># optional parameter with search_defaults that depends on other parameter values</span>
            <span class="s2">&quot;param6&quot;</span><span class="p">:</span> <span class="n">PassConfigParam</span><span class="p">(</span>
                <span class="n">type_</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
                <span class="n">default_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">search_defaults</span><span class="o">=</span><span class="n">Conditional</span><span class="p">(</span>
                    <span class="n">parents</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;param2&quot;</span><span class="p">,</span> <span class="s2">&quot;param3&quot;</span><span class="p">),</span>
                    <span class="c1"># invalid if (param2, param3) not in [(1, 1), (1, 2)]</span>
                    <span class="n">support</span><span class="o">=</span><span class="p">{</span>
                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span> <span class="n">Categorical</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
                        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span> <span class="n">Categorical</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]),</span>
                    <span class="p">},</span>
                <span class="p">),</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;param6 description&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">}</span>

</pre></div>
</div>
</section>
</section>
<section id="implement-the-run-function">
<h2>3. Implement the run function<a class="headerlink" href="#implement-the-run-function" title="Link to this heading">#</a></h2>
<p>The final step is to implement the <code class="docutils literal notranslate"><span class="pre">_run_for_config</span></code> method to optimize the input model. Olive Engine will invoke the
method while auto tuning the model. This method will also receive a search point (one set of configuration option from
the search space created based on the options defined in <code class="docutils literal notranslate"><span class="pre">_default_config(cls,</span> <span class="pre">accelerator_spec:</span> <span class="pre">AcceleratorSpec)</span></code>) along
with output path. The method should return a valid OliveModelHandler which can be used as an input for the next Pass.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_for_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ONNXModelHandler</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">output_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ONNXModelHandler</span><span class="p">:</span>
</pre></div>
</div>
</section>
<section id="update-olive-config-json">
<h2>4. Update olive_config.json<a class="headerlink" href="#update-olive-config-json" title="Link to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">olive_config.json</span></code> lists the features of the new Pass to help Olive determine when to use the pass. Add an entry
for the new pass with relevant info.</p>
<section id="id1">
<h3>Example<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>        <span class="s2">&quot;NewOptimizationTrick&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;module_path&quot;</span><span class="p">:</span> <span class="s2">&quot;olive.passes.onnx.new_opt_pass.NewOptimizationTrick&quot;</span><span class="p">,</span>
            <span class="s2">&quot;supported_providers&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;CPUExecutionProvider&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;supported_accelerators&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;cpu&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;supported_precisions&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;int8&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;supported_algorithms&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;new_algorithm&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;supported_quantization_encodings&quot;</span><span class="p">:</span> <span class="p">[</span>  <span class="p">],</span>
            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;extra_dependencies&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;dependent_on_this_external_pkg&quot;</span> <span class="p">],</span>
            <span class="s2">&quot;run_on_target&quot;</span><span class="p">:</span> <span class="n">true</span>
        <span class="p">},</span>
</pre></div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="design.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Design</p>
      </div>
    </a>
    <a class="right-next"
       href="custom-model-evaluator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How to extend Olive to add custom model evaluator</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-a-new-class">1. Define a new class</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#define-configuration">2. Define configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implement-the-run-function">3. Implement the run function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#update-olive-config-json">4. Update olive_config.json</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Example</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023-2025, Olive Dev team.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>