parameters:
  python_version: '3.8'
  onnxruntime: 'onnxruntime'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: ${{ parameters.python_version }}
  displayName: Use Python ${{ parameters.python_version }}

# TODO(anyone): allow job to specify torch version like onnxruntime if needed
# need to find a good way to set a default value for torch_version, maybe as variable instead of parameter
- script: python -m pip install torch==2.3.1
  displayName: Install torch

- script: python -m pip install .
  displayName: Install Olive

- ${{ if startsWith(parameters.onnxruntime, 'ort-nightly') }}:
  - script: |
      pip install onnxruntime
      pip uninstall -y onnxruntime
      pip install ${{ parameters.onnxruntime }} --index-url https://aiinfra.pkgs.visualstudio.com/PublicPackages/_packaging/ORT-Nightly/pypi/simple/
    displayName: Install ${{ parameters.onnxruntime }}
- ${{ else }}:
  - script: |
      pip install ${{ parameters.onnxruntime }}
    displayName: Install ${{ parameters.onnxruntime }}
