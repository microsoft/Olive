parameters:
  python_version: '3.10'
  onnxruntime: 'onnxruntime'
  torch: torch

steps:
- script: |
    apt update
    DEBIAN_FRONTEND=noninteractive apt install software-properties-common -y
    DEBIAN_FRONTEND=noninteractive add-apt-repository ppa:deadsnakes/ppa
    apt install python${{ parameters.python_version }} -y
  displayName: Install Python ${{ parameters.python_version }}

- task: UsePythonVersion@0
  inputs:
    versionSpec: ${{ parameters.python_version }}
  displayName: Use Python ${{ parameters.python_version }}

- script: python -m pip install ${{ parameters.torch }}
  displayName: Install torch

- script: python -m pip install .
  displayName: Install Olive

- ${{ if startsWith(parameters.onnxruntime, 'ort-nightly') }}:
  - script: |
      pip install onnxruntime
      pip uninstall -y onnxruntime
      pip install ${{ parameters.onnxruntime }} --index-url https://aiinfra.pkgs.visualstudio.com/PublicPackages/_packaging/ORT-Nightly/pypi/simple/
    displayName: Install ${{ parameters.onnxruntime }}
- ${{ else }}:
  - script: |
      pip install ${{ parameters.onnxruntime }}
    displayName: Install ${{ parameters.onnxruntime }}
