<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BERT optimization with PTQ on CPU &mdash; Olive  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/autodoc_pydantic.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/width.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <script src="../_static/js/custom_version.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ResNet optimization with PTQ on CPU" href="quickstart_resnet_example.html" />
    <link rel="prev" title="Quickstart Examples" href="quickstart_examples.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Olive
          </a>
              <div class="version">
                0.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">OVERVIEW</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/olive.html">Olive</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/quicktour.html">Quick Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/options.html">Olive Options</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GET STARTED</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="quickstart_examples.html">Quickstart Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">BERT optimization with PTQ on CPU</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pip-requirements">Pip requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#run-sample-using-config-the-optimization-techniques-to-run-are-specified-in-bert-config-json">Run sample using config. The optimization techniques to run are specified in bert_config.json</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optimize-model-automatically-without-selecting-any-optimization-technique">Optimize model automatically without selecting any optimization technique.</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="quickstart_resnet_example.html">ResNet optimization with PTQ on CPU</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">TUTORIALS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_systems.html">Configuring OliveSystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_metrics.html">Configuring Metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_pass.html">Configuring Pass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/configure_hardware_optimizations.html">Configuring HW-dependent optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/advanced_users.html">Advanced User Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/how_to_add_pass.html">How to add new Pass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/how_to_write_userscript.html">How to write <code class="docutils literal notranslate"><span class="pre">user_script</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/packaging_output_models.html">Packaging Olive artifacts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXAMPLES</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Inception model optimization on Qualcomm NPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#cifar10-optimization-with-openvino-for-intel-hw">Cifar10 optimization with OpenVINO for Intel HW</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#bert-optimization-with-qat-customized-training-loop-on-cpu">BERT optimization with QAT Customized Training Loop on CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#resnet-optimization-with-qat-default-training-loop-on-cpu">ResNet optimization with QAT Default Training Loop on CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#resnet-optimization-with-qat-pytorch-lightning-module-on-cpu">ResNet optimization with QAT PyTorch Lightning Module on CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#squeezenet-latency-optimization-with-directml">SqueezeNet latency optimization with DirectML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#stable-diffusion-optimization-with-directml">Stable Diffusion optimization with DirectML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#bert-optimization-with-intel-neural-compressor-post-training-quantization-on-cpu">BERT optimization with Intel® Neural Compressor Post Training quantization on CPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html#whisper-optimization-using-ort-toolchain">Whisper optimization using ORT toolchain</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API REFERENCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">OliveModels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/systems.html">OliveSystems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/evaluator.html">OliveEvaluator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/metric.html">Metric</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/search-algorithms.html">SearchAlgorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/engine.html">Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/passes.html">Passes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Olive</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="quickstart_examples.html">Quickstart Examples</a></li>
      <li class="breadcrumb-item active">BERT optimization with PTQ on CPU</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getstarted/quickstart_bert_example.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="bert-optimization-with-ptq-on-cpu">
<h1>BERT optimization with PTQ on CPU<a class="headerlink" href="#bert-optimization-with-ptq-on-cpu" title="Permalink to this heading">¶</a></h1>
<p>This is a sample use case of Olive to optimize a <a class="reference external" href="https://huggingface.co/Intel/bert-base-uncased-mrpc">Bert</a> model using onnx conversion, onnx transformers optimization,
onnx quantization tuner and performance tuning.</p>
<p>Performs optimization pipeline:</p>
<ul class="simple">
<li><p><em>PyTorch Model -&gt; Onnx Model -&gt; Transformers Optimized Onnx Model -&gt; Quantized Onnx Model -&gt; Tune performance</em></p></li>
</ul>
<p>Outputs the best metrics, model, and corresponding Olive config.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this heading">¶</a></h2>
<p>Please go to example repository <a class="reference external" href="https://github.com/microsoft/Olive/tree/main/examples/bert_ptq_cpu">Quickstart Bert Example</a></p>
<section id="pip-requirements">
<h3>Pip requirements<a class="headerlink" href="#pip-requirements" title="Permalink to this heading">¶</a></h3>
<p>Install the necessary python packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
</section>
<section id="run-sample-using-config-the-optimization-techniques-to-run-are-specified-in-bert-config-json">
<h2>Run sample using config. The optimization techniques to run are specified in bert_config.json<a class="headerlink" href="#run-sample-using-config-the-optimization-techniques-to-run-are-specified-in-bert-config-json" title="Permalink to this heading">¶</a></h2>
<p>First, install required packages according to passes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">olive</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">bert_config</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">setup</span>
</pre></div>
</div>
<p>Then, optimize the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">olive</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">bert_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>or run simply with python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">olive.workflows</span> <span class="kn">import</span> <span class="n">run</span> <span class="k">as</span> <span class="n">olive_run</span>
<span class="n">olive_run</span><span class="p">(</span><span class="s2">&quot;bert_config.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="optimize-model-automatically-without-selecting-any-optimization-technique">
<h2>Optimize model automatically without selecting any optimization technique.<a class="headerlink" href="#optimize-model-automatically-without-selecting-any-optimization-technique" title="Permalink to this heading">¶</a></h2>
<p>First, install required packages according to passes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">olive</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">auto_bert_config</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">setup</span>
</pre></div>
</div>
<p>Then, optimize the model</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">olive</span><span class="o">.</span><span class="n">workflows</span><span class="o">.</span><span class="n">run</span> <span class="o">--</span><span class="n">config</span> <span class="n">auto_bert_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>or run simply with python code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">olive.workflows</span> <span class="kn">import</span> <span class="n">run</span> <span class="k">as</span> <span class="n">olive_run</span>
<span class="n">olive_run</span><span class="p">(</span><span class="s2">&quot;auto_bert_config.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After running the above command, the model candidates and corresponding config will be saved in the output directory.
You can then select the best model and config from the candidates and run the model with the selected config.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart_examples.html" class="btn btn-neutral float-left" title="Quickstart Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="quickstart_resnet_example.html" class="btn btn-neutral float-right" title="ResNet optimization with PTQ on CPU" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, olivedevteam@microsoft.com.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>